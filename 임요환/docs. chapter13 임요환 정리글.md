## 까다로운 테스트
- 스레드와 영속성에 관련된 코드 테스트는 까다로움
- 설계 다시 하기
- 스텁과 목을 사용하여 의존성 끊기

### 멀티스레드 코드 테스트
- 동작하는 동시성(concurrent) 코드를 작성하는 것은 어려움
- 동시성 처리 테스트는 통합 테스트로 분류하는 것이 나음

#### 단순하고 똑똑하게 유지
- 스레드 통제와 애플리케이션 코드 사이의 중첩을 최소화해라
- 다른 사람의 작업을 믿어라 = java.util.concurrent, BlockingQueue 클래스 등

#### 모든 매칭 찾기
- Listener 클래스 활용

#### 애플리케이션 로직 추출
- 애플리케이션 로직과 스레드 로직을 분리

#### 스레드 로직의 테스트 지원을 위해 재설계
#### 스레드 로직을 위한 테스트 작성
- 애플리케이션 로직과 스레드 로직의 관심사를 분리하여 짧은 순서로 테스트를 작성할 수 있음
- 스레드 중심 테스트를 처리하는데 도움이 되는 유틸리티 메서드를 만들며 테스트가 쉬워짐

### 데이터베이스 테스트
#### 고마워, Controller
- JPA 관련 인터페이스를 모두 스텁으로 만드는 것은 테스트하기가 어려움
- 데이터베이스와 성공적으로 상호 작용하는 Controller 클래스에 대한 테스트 작성

#### 데이터 문제
- 테스트 데이터가 데이터베이스에 있다고 가정하는 것은 매우 공통스러움 -> 시간이지나 변질되며 테스트도 망가짐
- 테스트 데이터는 테스트 안에서 데이터를 생성하고 관리해야 함
- 데이터베이스가 트랜잭션을 지원한다면 테스트마다 트랜잭션을 초기화하고 테스트가 끝나면 롤백해라

#### 클린 룸 데이터베이스 테스트
- @Before와 @After 메서드를 활용하여 데이터베이스를 초기화함

#### controller를 목 처리
- 테스트를 통과한 controller를 목으로 사용하므로 그 안의 메서드를 안전하게 스텁으로 만들 수 있음
- 모키토는 테스트에서 목의 활용을 단순하고 선언적으로 유지하게 함

### 마치며
- 관심사를 분리하라
    - 애플리케이션 로직은 스레드, 데이터베이스 혹은 문제를 일으킬 수 있는 다른 의존성과 분리하라
    - 의존적인 코드는 고립시켜서 코드 베이스에 만연하지 않도록 해야함
- 느리거나 휘발적인 코드는 목으로 대체하여 단위 테스트의 의존성을 끊어라
- 필요한 경우 통합 테스트를 작성하되 단순하고 집중적으로 만들어라